
    <html>
      <head>
        <title>localFile_cloudSync_Server</title>
        <meta charset='utf-8'/>
      </head>
      <body>
        <h1>localFile_cloudSync_Server</h1>

        <h2>Status</h2>
        <ul>
          <li>local_root: <code>/home/n150/openclaw_workspace/search_docs</code></li>
          <li>web: <code>http://0.0.0.0:8765</code></li>
          <li>log: <code>/home/n150/openclaw_workspace/localFile_cloudSync_Server/runtime/service.log</code></li>
          <li>db: <code>/home/n150/openclaw_workspace/localFile_cloudSync_Server/runtime/service.db</code></li>
          <li>last_run_once: <code>/home/n150/openclaw_workspace/localFile_cloudSync_Server/runtime/last_run_once.json</code></li>
        </ul>

        <h2>Quick Actions</h2>
        <button id='btnRunOnce' onclick='runOnce()'>Run Once</button>
        <button onclick='restartService()'>Restart Service</button>
        <button onclick='refreshFeishu()'>Refresh Feishu Status</button>
        <button onclick='refreshRunOnce()'>Refresh Last Run Summary</button>
        <button onclick='refreshLogs()'>Refresh Logs</button>
        <button onclick='refreshDb()'>Refresh DB</button>
        <button onclick='refreshAll()'>Refresh All</button>

        <h2>Feishu Status</h2>
        <pre id='feishu' style='background:#111;color:#ddd;padding:12px;max-height:260px;overflow:auto'></pre>

        <h2>Last Run Once Summary</h2>
        <pre id='run_once' style='background:#111;color:#ddd;padding:12px;max-height:260px;overflow:auto'></pre>

        <h2>Config (quick edit)</h2>
        <form id='cfg'>
          <label>web_bind_host <input name='web_bind_host' value='0.0.0.0'/></label><br/>
          <label>web_port <input name='web_port' value='8765'/></label><br/>
          <label>sync.local_root <input name='sync.local_root' value='/home/n150/openclaw_workspace/search_docs' size='60'/></label><br/>
          <label>auth.app_id <input name='auth.app_id' value='' size='40'/></label><br/>
          <label>auth.app_secret <input name='auth.app_secret' value='' size='40'/></label><br/>
          <label>auth.user_token_file <input name='auth.user_token_file' value='/home/n150/.openclaw/backups/redefine-20260221-003711/workspace/skills/feishu-user-auth/user_tokens.json' size='60'/></label><br/>
          <button type='button' onclick='saveCfg()'>Save Config</button>
        </form>

        <h2>Logs (tail)</h2>
        <pre id='logs' style='background:#111;color:#ddd;padding:12px;max-height:300px;overflow:auto'></pre>

        <h2>DB</h2>
        <pre id='db' style='background:#111;color:#ddd;padding:12px;max-height:160px;overflow:auto'></pre>

        <pre id='out'></pre>

        <script>
        function asJson(value) {
          return JSON.stringify(value, null, 2);
        }

        async function postJson(url, payload = {}) {
          const resp = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify(payload)
          });
          const text = await resp.text();
          try {
            return JSON.parse(text);
          } catch (_e) {
            return { raw: text };
          }
        }

        async function restartService() {
          const data = await postJson('/api/actions/restart');
          document.getElementById('out').textContent = asJson(data);
        }

        async function runOnce() {
          const btn = document.getElementById('btnRunOnce');
          btn.disabled = true;
          btn.textContent = 'Running...';
          try {
            const data = await postJson('/api/actions/run-once');
            document.getElementById('out').textContent = asJson(data);
            document.getElementById('run_once').textContent = asJson(data);
            await refreshLogs();
            await refreshDb();
          } finally {
            btn.disabled = false;
            btn.textContent = 'Run Once';
          }
        }

        async function saveCfg() {
          const form = document.getElementById('cfg');
          const data = {
            web_bind_host: form['web_bind_host'].value,
            web_port: parseInt(form['web_port'].value, 10),
            sync: { local_root: form['sync.local_root'].value },
            auth: {
              app_id: form['auth.app_id'].value,
              app_secret: form['auth.app_secret'].value,
              user_token_file: form['auth.user_token_file'].value,
            }
          };
          const resp = await fetch('/api/config', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify(data)
          });
          const result = await resp.json();
          document.getElementById('out').textContent = asJson(result);
        }

        async function refreshFeishu() {
          const resp = await fetch('/api/status/feishu');
          const data = await resp.json();
          document.getElementById('feishu').textContent = asJson(data);
        }

        async function refreshRunOnce() {
          const resp = await fetch('/api/status/run-once');
          const data = await resp.json();
          document.getElementById('run_once').textContent = asJson(data);
        }

        async function refreshLogs() {
          const resp = await fetch('/api/logs?n=200');
          const data = await resp.json();
          document.getElementById('logs').textContent = data.tail;
        }

        async function refreshDb() {
          const resp = await fetch('/api/db');
          const data = await resp.json();
          document.getElementById('db').textContent = asJson(data);
        }

        async function refreshAll() {
          await refreshFeishu();
          await refreshRunOnce();
          await refreshLogs();
          await refreshDb();
        }

        refreshAll();
        </script>
      </body>
    </html>
    